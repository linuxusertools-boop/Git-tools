<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>kevcodex | GitHub Ultra Deployer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root { --gh-blue: #0969da; --gh-bg: #f6f8fa; --gh-border: #d0d7de; --gh-danger: #cf222e; --gh-success: #1f883d; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; background-color: #ffffff; margin: 0; color: #1f2328; }
        .banner { background: #1b4b82 linear-gradient(135deg, #1b4b82 0%, #2b6cb0 100%); color: white; padding: 40px 20px; text-align: center; position: relative; }
        .banner-icon { background: white; width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; }
        .banner-icon svg { fill: #1b4b82; width: 35px; }
        .container { max-width: 800px; margin: -20px auto 50px; padding: 0 20px; }
        .box { background: white; border: 1px solid var(--gh-border); border-radius: 6px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); padding: 25px; }
        input, select { width: 100%; padding: 10px; border: 1px solid var(--gh-border); border-radius: 6px; margin-bottom: 15px; background: #fafafa; box-sizing: border-box; }
        .btn { padding: 12px; font-weight: 600; border-radius: 6px; border: 1px solid rgba(0,0,0,0.1); cursor: pointer; width: 100%; transition: 0.2s; }
        .btn-primary { background: var(--gh-success); color: white; }
        .btn-danger { background: var(--gh-danger); color: white; margin-top: 10px; }
        #log { background: #0d1117; color: #7ee787; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 12px; margin-top: 20px; height: 200px; overflow-y: auto; display: none; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="banner">
    <div class="banner-icon">
        <svg viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.165 6.839 9.49.5.09.682-.218.682-.485 0-.24-.009-.875-.013-1.716-2.782.604-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.463-1.11-1.463-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.011 10.011 0 0022 12c0-5.523-4.477-10-10-10z"></path></svg>
    </div>
    <h1 style="margin:0">GitHub Ultra Deploy</h1>
    <p style="margin:5px 0 0; opacity: 0.8;">Satu kali klik, langsung terisi.</p>
</div>

<div class="container">
    <div class="box">
        <div id="setup">
            <label>GitHub Token</label>
            <input type="password" id="token" placeholder="ghp_xxxxxx">
            <button class="btn btn-primary" onclick="loadRepos()">Hubungkan</button>
        </div>
        <div id="main" class="hidden">
            <label>Pilih Repository</label>
            <select id="repoList"></select>
            <label>Pilih ZIP</label>
            <input type="file" id="zipFile" accept=".zip">
            <button class="btn btn-danger" onclick="doUltraDeploy()">Mulai Deploy Sekarang</button>
        </div>
        <div id="log"></div>
    </div>
</div>

<script>
    let TOKEN = "";
    const log = (m, c = "#7ee787") => { const l = document.getElementById('log'); l.style.display = "block"; l.innerHTML += `<div style="color:${c}">> ${m}</div>`; l.scrollTop = l.scrollHeight; };

    async function loadRepos() {
        TOKEN = document.getElementById('token').value;
        const r = await fetch('https://api.github.com/user/repos?per_page=100', { headers: { 'Authorization': `token ${TOKEN}` }});
        if(!r.ok) return alert("Token Salah!");
        const data = await r.json();
        document.getElementById('repoList').innerHTML = data.map(repo => `<option value="${repo.full_name}">${repo.full_name}</option>`).join('');
        document.getElementById('setup').classList.add('hidden');
        document.getElementById('main').classList.remove('hidden');
    }

    async function doUltraDeploy() {
        const repo = document.getElementById('repoList').value;
        const file = document.getElementById('zipFile').files[0];
        if(!file) return alert("Pilih ZIP!");
        
        log("Mengekstrak ZIP...", "#ffa657");
        const zip = await JSZip.loadAsync(file);
        const files = Object.keys(zip.files).filter(k => !zip.files[k].dir);
        
        try {
            const repoInfo = await fetch(`https://api.github.com/repos/${repo}`, { headers: { 'Authorization': `token ${TOKEN}` }}).then(r => r.json());
            const branch = repoInfo.default_branch;

            // 1. Buat Blobs (File konten)
            const treeItems = [];
            for (const path of files) {
                log(`Memproses: ${path}`);
                const content = await zip.files[path].async("uint8array");
                let binary = "";
                for (let i = 0; i < content.byteLength; i++) binary += String.fromCharCode(content[i]);
                
                const blob = await fetch(`https://api.github.com/repos/${repo}/git/blobs`, {
                    method: 'POST',
                    headers: { 'Authorization': `token ${TOKEN}` },
                    body: JSON.stringify({ content: window.btoa(binary), encoding: 'base64' })
                }).then(r => r.json());
                
                treeItems.push({ path: path, mode: '100644', type: 'blob', sha: blob.sha });
            }

            // 2. Buat Tree Baru (Ini yang membuat folder lama langsung hilang)
            log("Membuat struktur folder baru...", "#ffa657");
            const newTree = await fetch(`https://api.github.com/repos/${repo}/git/trees`, {
                method: 'POST',
                headers: { 'Authorization': `token ${TOKEN}` },
                body: JSON.stringify({ tree: treeItems }) // Tanpa base_tree = Hapus Semua yang lama!
            }).then(r => r.json());

            // 3. Buat Commit
            log("Finalisasi data...");
            const commit = await fetch(`https://api.github.com/repos/${repo}/git/commits`, {
                method: 'POST',
                headers: { 'Authorization': `token ${TOKEN}` },
                body: JSON.stringify({ message: "Nexu Ultra Deploy: Clean & Build", tree: newTree.sha })
            }).then(r => r.json());

            // 4. Update Reference (Force Update)
            log("Mengunggah ke GitHub...", "#3fb950");
            await fetch(`https://api.github.com/repos/${repo}/git/refs/heads/${branch}`, {
                method: 'PATCH',
                headers: { 'Authorization': `token ${TOKEN}` },
                body: JSON.stringify({ sha: commit.sha, force: true })
            });

            log("ðŸŽ‰ BERHASIL! Repository 100% sudah terisi.", "#3fb950");
            alert("Selesai! Sekarang cek repo kamu.");
        } catch (e) { log("Error: " + e.message, "red"); }
    }
</script>
</body>
</html>
